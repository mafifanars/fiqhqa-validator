{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents an annotator or administrator within the QAFiqih Validation Tool.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "name": {
          "type": "string",
          "description": "The user's display name."
        },
        "username": {
          "type": "string",
          "description": "The user's username or email address."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates whether the user account is currently active."
        }
      },
      "required": [
        "id",
        "name",
        "username",
        "isActive"
      ]
    },
    "AnnotationItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AnnotationItem",
      "type": "object",
      "description": "Represents a single item to be annotated within a QAFiqih validation project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the annotation item."
        },
        "url": {
          "type": "string",
          "description": "URL of the original article."
        },
        "madhab": {
          "type": "string",
          "description": "The madhab (school of thought) associated with the article."
        },
        "topic": {
          "type": "string",
          "description": "The topic of the article."
        },
        "question": {
          "type": "string",
          "description": "The extracted question from the article."
        },
        "content": {
          "type": "string",
          "description": "The full article content."
        }
      },
      "required": [
        "id",
        "url",
        "madhab",
        "topic",
        "question",
        "content"
      ]
    },
    "Verdict": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Verdict",
      "type": "object",
      "description": "Represents a verdict associated with an annotation item.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the verdict."
        },
        "annotationItemId": {
          "type": "string",
          "description": "Reference to AnnotationItem. (Relationship: AnnotationItem 1:N Verdict)"
        },
        "label": {
          "type": "string",
          "description": "The legal label assigned to the verdict (e.g., wajib, sunnah)."
        },
        "context": {
          "type": "string",
          "description": "The verbatim context from the article supporting the verdict."
        }
      },
      "required": [
        "id",
        "annotationItemId",
        "label",
        "context"
      ]
    },
    "Justification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Justification",
      "type": "object",
      "description": "Represents a justification (primary or secondary source) for a verdict.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the justification."
        },
        "annotationItemId": {
          "type": "string",
          "description": "Reference to AnnotationItem. (Relationship: AnnotationItem 1:N Justification)"
        },
        "type": {
          "type": "string",
          "description": "The type of justification (primary or secondary)."
        },
        "textTranslation": {
          "type": "string",
          "description": "The verbatim text or translation of the justification."
        },
        "reference": {
          "type": "string",
          "description": "Reference to the source of the justification (e.g., Quran verse, Hadith)."
        },
        "scholar": {
          "type": "string",
          "description": "The scholar associated with the secondary source justification."
        },
        "sourceDetail": {
          "type": "string",
          "description": "Details about the source of the justification (e.g., book name, page number)."
        },
        "quoteVerbatim": {
          "type": "string",
          "description": "The verbatim quote from the secondary source justification."
        }
      },
      "required": [
        "id",
        "annotationItemId",
        "type"
      ]
    },
    "Annotation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Annotation",
      "type": "object",
      "description": "Represents a single annotation made by an annotator for an annotation item.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the annotation."
        },
        "annotationItemId": {
          "type": "string",
          "description": "Reference to AnnotationItem. (Relationship: AnnotationItem 1:N Annotation)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Annotation)"
        },
        "isFatwa": {
          "type": "boolean",
          "description": "Indicates whether the annotator determined the article to be a fatwa or not."
        },
        "nonFatwaReason": {
          "type": "string",
          "description": "The reason provided by the annotator if the article is not a fatwa."
        },
        "questionQualityScore": {
          "type": "number",
          "description": "A score (1-3) indicating the quality of the question."
        },
        "annotationStatus": {
          "type": "string",
          "description": "The annotation's current status ('Not Started', 'In Progress', 'Completed', 'Non-Fatwa')."
        }
      },
      "required": [
        "id",
        "annotationItemId",
        "userId",
        "isFatwa"
      ]
    },
    "ItemAssignment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ItemAssignment",
      "type": "object",
      "description": "Represents the assignment of an annotation item to a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the item assignment."
        },
        "annotationItemId": {
          "type": "string",
          "description": "Reference to AnnotationItem. (Relationship: AnnotationItem 1:N ItemAssignment)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ItemAssignment)"
        },
        "assignedDate": {
          "type": "string",
          "description": "The timestamp of the assignment.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "annotationItemId",
        "userId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Path-based ownership simplifies security.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/annotationItems/{annotationItemId}",
        "definition": {
          "entityName": "AnnotationItem",
          "schema": {
            "$ref": "#/backend/entities/AnnotationItem"
          },
          "description": "Stores all annotation items for the application.",
          "params": [
            {
              "name": "annotationItemId",
              "description": "The unique identifier of the annotation item."
            }
          ]
        }
      },
      {
        "path": "/annotationItems/{annotationItemId}/annotations/{annotationId}",
        "definition": {
          "entityName": "Annotation",
          "schema": {
            "$ref": "#/backend/entities/Annotation"
          },
          "description": "Stores annotations for a specific annotation item.",
          "params": [
            {
              "name": "annotationItemId",
              "description": "The unique identifier of the annotation item."
            },
            {
              "name": "annotationId",
              "description": "The unique identifier of the annotation."
            }
          ]
        }
      },
      {
        "path": "/annotationItems/{annotationItemId}/verdicts/{verdictId}",
        "definition": {
          "entityName": "Verdict",
          "schema": {
            "$ref": "#/backend/entities/Verdict"
          },
          "description": "Stores verdicts associated with an annotation item.",
          "params": [
            {
              "name": "annotationItemId",
              "description": "The unique identifier of the annotation item."
            },
            {
              "name": "verdictId",
              "description": "The unique identifier of the verdict."
            }
          ]
        }
      },
      {
        "path": "/annotationItems/{annotationItemId}/justifications/{justificationId}",
        "definition": {
          "entityName": "Justification",
          "schema": {
            "$ref": "#/backend/entities/Justification"
          },
          "description": "Stores justifications for a verdict.",
          "params": [
            {
              "name": "annotationItemId",
              "description": "The unique identifier of the annotation item."
            },
            {
              "name": "justificationId",
              "description": "The unique identifier of the justification."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/itemAssignments/{itemAssignmentId}",
        "definition": {
          "entityName": "ItemAssignment",
          "schema": {
            "$ref": "#/backend/entities/ItemAssignment"
          },
          "description": "Stores the assignments of annotation items to users. Path-based ownership for easy and secure rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "itemAssignmentId",
              "description": "The unique identifier of the item assignment."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure has been flattened to a single-project model to enhance simplicity and performance. The top-level `/projects` collection has been removed. All `annotationItems` now reside in a single root collection. This eliminates the need for `collectionGroup` queries, which were causing permission issues, and simplifies data access logic throughout the admin and annotator sections of the application. User-specific data like `itemAssignments` remains nested under `/users/{userId}` to maintain clear ownership and straightforward security rules."
  }
}
    